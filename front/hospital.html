{% extends "base.html" %}
{% block content %}

<h2 class="text-center text-danger fw-bold mb-4">üè• Hospital Management</h2>


<!-- ===================================================== -->
<!--                    ADD HOSPITAL                      -->
<!-- ===================================================== -->
<div class="card shadow-sm p-4 mb-4">
    <h4 class="text-danger fw-bold mb-3 text-center">‚ûï Add New Hospital</h4>

    <form method="POST" action="/hospital">
        <div class="row g-3">

            <div class="col-md-6">
                <label class="form-label">Hospital Name</label>
                <input type="text" name="Hs_name" class="form-control" required>
            </div>

            <div class="col-md-6">
                <label class="form-label">Contact</label>
                <input type="number" name="Hs_contact" class="form-control" required>
            </div>

            <div class="col-md-12">
                <label class="form-label">Address</label>
                <textarea name="Hs_address" class="form-control" required></textarea>
            </div>

            <input type="hidden" name="F1_id" value="1">
        </div>

        <div class="text-center mt-3">
            <button class="btn btn-danger px-5">Add Hospital</button>
        </div>
    </form>
</div>



<!-- ===================================================== -->
<!--                  HOSPITAL LIST VIEW                   -->
<!-- ===================================================== -->
<h4 class="text-danger fw-bold mb-3 text-center">üìã Hospital List</h4>

<table class="table table-bordered table-striped text-center shadow-sm">
    <thead class="table-danger">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Address</th>
            <th>Contact</th>
        </tr>
    </thead>
    <tbody>
        {% for h in hospitals %}
        <tr>
            <td>{{ h[0] }}</td>
            <td>{{ h[1] }}</td>
            <td>{{ h[2] }}</td>
            <td>{{ h[3] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>



<!-- ===================================================== -->
<!--                    PLACE BLOOD ORDER                  -->
<!-- ===================================================== -->
<div class="card shadow-sm p-4 mt-4">
    <h4 class="text-danger fw-bold mb-3 text-center">ü©∏ Place Blood Order</h4>

    <form method="POST" action="/hospital_order">

        <div class="row g-3">

            <!-- SELECT PATIENT -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Select Existing Patient</label>
                <select id="patientSelect" class="form-select">
                    <option value="">Choose Patient</option>

                    {% for c in customers %}
                    <option
                        value="{{ c[0] }}"
                        data-cname="{{ c[1] }}"
                        data-ccontact="{{ c[2] }}"
                        data-cgender="{{ c[3] }}"
                        data-caddress="{{ c[4] }}"
                        data-hid="{{ c[5] }}"
                    >
                        {{ c[1] }} (ID: {{ c[0] }})
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- AUTO HOSPITAL -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Hospital</label>
                <select name="Hs2_id" id="hospitalField" class="form-select" required>
                    <option value="">Choose Hospital</option>
                    {% for h in hospitals %}
                    <option value="{{ h[0] }}">{{ h[1] }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- BLOOD BANK -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Blood Bank</label>
                <select name="BB4_id" class="form-select" required>
                    <option value="">Choose Blood Bank</option>
                    {% for b in bloodbanks %}
                    <option value="{{ b[0] }}">{{ b[1] }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- BLOOD TYPE -->
            <div class="col-md-6">
                <label class="form-label fw-semibold">Blood Type</label>
                <select name="Or_type" class="form-select">
                    <option>A+</option><option>A-</option>
                    <option>B+</option><option>B-</option>
                    <option>AB+</option><option>AB-</option>
                    <option>O+</option><option>O-</option>
                </select>
            </div>

            <!-- QUANTITY -->
            <div class="col-md-6">
                <label class="form-label">Quantity (ml)</label>
                <input type="number" name="Or_quantity" class="form-control" required>
            </div>

            <!-- PATIENT DETAILS -->
            <div class="col-md-6">
                <label class="form-label">Patient Name</label>
                <input type="text" name="C_name" id="pname" class="form-control" required>
            </div>

            <div class="col-md-6">
                <label class="form-label">Patient Contact</label>
                <input type="text" name="C_contact" id="pcontact" class="form-control" required>
            </div>

            <div class="col-md-6">
                <label class="form-label">Patient Gender</label>
                <input type="text" name="C_gender" id="pgender" class="form-control" required>
            </div>

            <div class="col-md-12">
                <label class="form-label">Patient Address</label>
                <textarea name="C_address" id="paddress" class="form-control" rows="2"></textarea>
            </div>

        </div>

        <div class="text-center mt-3">
            <button class="btn btn-danger px-5">Place Order</button>
        </div>

    </form>
</div>



<!-- ===================================================== -->
<!--                      ORDER LIST                       -->
<!-- ===================================================== -->
<h4 class="text-danger fw-bold mt-5 text-center">üì¶ Orders Placed</h4>

{% if orders %}
<table class="table table-bordered table-striped shadow-sm text-center">
    <thead class="table-danger">
        <tr>
            <th>Order ID</th>
            <th>Hospital</th>
            <th>Patient</th>
            <th>Blood Bank</th>
            <th>Blood Type</th>
            <th>Quantity</th>
            <th>Status</th>
            <th>Invoice / Payment</th>
        </tr>
    </thead>

    <tbody>
        {% for o in orders %}
        <tr>
            <td>{{ o[0] }}</td>
            <td>{{ o[1] }}</td>
            <td>{{ o[2] }}</td>
            <td>{{ o[3] }}</td>
            <td>{{ o[4] }}</td>
            <td>{{ o[5] }}</td>
            <td>{{ o[6] }}</td>

            <td>
                {% if o[6] == "Pending" %}
                    <span class="badge bg-warning">Pending</span>

                {% elif o[6] == "Invoiced" %}
                    <a href="/customer_payment" class="btn btn-success btn-sm">Pay Now</a>

                {% elif o[6] == "Completed" %}
                    <span class="badge bg-success">Paid</span>

                {% else %}
                    <span class="badge bg-secondary">Unknown</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}
<div class="alert alert-warning text-center fw-semibold">
    ‚ö† No orders found.
</div>
{% endif %}




<!-- ===================================================== -->
<!--                      SCRIPT SECTION                   -->
<!-- ===================================================== -->
<script>
document.getElementById("patientSelect").addEventListener("change", function () {
    let opt = this.options[this.selectedIndex];
    if (opt.value === "") return;

    document.getElementById("pname").value = opt.dataset.cname;
    document.getElementById("pcontact").value = opt.dataset.ccontact;
    document.getElementById("pgender").value = opt.dataset.cgender;
    document.getElementById("paddress").value = opt.dataset.caddress;

    if (opt.dataset.hid)
        document.getElementById("hospitalField").value = opt.dataset.hid;
});
</script>

{% endblock %}
